<!doctype html>
<html lang="tr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Haftanın Soruları - Test</title>
    <style>
      /* Minimal, clean styling (no external deps) */
      :root {
        --bg: #0f172a;         /* slate-900 */
        --card: #111827;       /* gray-900 */
        --muted: #9ca3af;      /* gray-400 */
        --text: #f8fafc;       /* slate-50 */
        --accent: #ef4444;     /* red-500 */
        --ok: #22c55e;         /* green-500 */
        --warn: #f59e0b;       /* amber-500 */
        --brand: #b30000;      /* Ziraat kırmızısı vibe */
      }
      html, body {
        background: radial-gradient(1000px 600px at 20% -10%, rgba(255,255,255,0.05), transparent 60%),
                    radial-gradient(800px 500px at 80% 110%, rgba(255,255,255,0.04), transparent 70%),
                    var(--bg);
        color: var(--text);
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      }
      .container {
        max-width: 900px;
        margin: 24px auto;
        padding: 16px;
      }
      .header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 16px;
      }
      .brand {
        width: 42px;
        height: 42px;
        border-radius: 10px;
        background: linear-gradient(145deg, var(--brand), #ff1a1a);
        box-shadow: 0 6px 20px rgba(179,0,0,0.4);
        display: grid;
        place-items: center;
        font-weight: 900;
        letter-spacing: 0.5px;
      }
      .card {
        background: linear-gradient(180deg, rgba(17,24,39,0.9), rgba(17,24,39,0.7));
        border: 1px solid rgba(255,255,255,0.06);
        border-radius: 18px;
        padding: 20px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.35);
      }
      .muted { color: var(--muted); }
      .pill {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 6px 10px;
        border: 1px solid rgba(255,255,255,0.1);
        border-radius: 999px;
        font-size: 12px;
        color: var(--muted);
      }
      .question-stem {
        font-size: 20px;
        font-weight: 700;
        line-height: 1.4;
        margin-bottom: 14px;
      }
      .choices {
        display: grid;
        gap: 10px;
      }
      .choice {
        border: 1px solid rgba(255,255,255,0.08);
        background: rgba(17,24,39,0.6);
        border-radius: 12px;
        padding: 12px 14px;
        cursor: pointer;
        transition: transform 120ms ease, background 200ms ease, border-color 200ms ease;
      }
      .choice:hover { transform: translateY(-1px); }
      .choice.correct { border-color: rgba(34,197,94,0.7); background: rgba(34,197,94,0.12); }
      .choice.incorrect { border-color: rgba(239,68,68,0.65); background: rgba(239,68,68,0.12); }
      .choice.disabled { pointer-events: none; opacity: 0.9; }
      .footer {
        display: flex;
        justify-content: space-between;
        gap: 12px;
        margin-top: 18px;
      }
      .btn {
        background: rgba(255,255,255,0.06);
        color: var(--text);
        border: 1px solid rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 10px 14px;
        cursor: pointer;
      }
      .btn.primary {
        background: linear-gradient(135deg, var(--brand), #ff4040);
        border: none;
      }
      .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      .progress {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 10px;
      }
      .bar {
        height: 8px;
        border-radius: 999px;
        background: rgba(255,255,255,0.08);
        overflow: hidden;
      }
      .bar > span {
        display: block;
        height: 100%;
        width: 0%;
        background: linear-gradient(90deg, #06b6d4, #3b82f6, #22c55e);
        transition: width 250ms ease;
      }
      .result {
        font-size: 18px;
        font-weight: 700;
      }
      .kbd {
        border: 1px solid rgba(255,255,255,0.15);
        padding: 2px 6px;
        border-radius: 6px;
        font-size: 12px;
      }
      .hint { font-size: 12px; color: var(--muted); }
      .small { font-size: 12px; }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <div class="brand">Z</div>
        <div>
          <div style="font-weight:800; letter-spacing:.3px;">Ziraat 2025 ÜYS • Haftanın Soruları</div>
          <div class="small muted">Her sayfada 1 soru • İşaretleyince anında yeşil/kırmızı geri bildirim</div>
        </div>
      </div>

      <div class="card">
        <div class="progress">
          <div class="pill" id="modePill">Quiz</div>
          <div class="muted small"><span id="counter">Soru 1 / ?</span></div>
        </div>
        <div class="bar"><span id="barFill"></span></div>

        <div id="screen"></div>

        <div class="footer">
          <button id="btnPrev" class="btn" disabled>Önceki <span class="kbd">←</span></button>
          <div style="display:flex; gap:8px;">
            <button id="btnReview" class="btn" style="display:none;">Yanlışları İncele</button>
            <button id="btnNext" class="btn primary">Sonraki <span class="kbd">→</span></button>
          </div>
        </div>
        <div class="hint" style="margin-top:8px;">Klavye kısayolları: <span class="kbd">1-5</span> şıkları işaretler, <span class="kbd">←</span>/<span class="kbd">→</span> sayfalar.</div>
      </div>

      <p class="small muted" style="margin-top:14px">
        Sorular /data/questions.json dosyasından yüklenir. GitHub Pages için tüm dosyaları bu depo köküyle birlikte yayınlayın.
      </p>
    </div>

    <script>
      const el = (sel) => document.querySelector(sel);
      const screen = el('#screen');
      const btnPrev = el('#btnPrev');
      const btnNext = el('#btnNext');
      const btnReview = el('#btnReview');
      const counter = el('#counter');
      const barFill = el('#barFill');
      const modePill = el('#modePill');

      /** App State */
      let questions = [];
      let current = 0;
      let selections = []; // index of selected choice per question
      let correctness = []; // true/false per question
      let mode = 'quiz'; // 'quiz' | 'result' | 'review'
      let reviewList = []; // indices of wrong questions when entering review mode
      let reviewPos = 0;

      async function load() {
        const res = await fetch('./quiz_questions.json?_=' + Date.now());
        questions = await res.json();
        selections = Array(questions.length).fill(null);
        correctness = Array(questions.length).fill(null);
        render();
        bindKeys();
      }

      function bindKeys(){
        window.addEventListener('keydown', (e)=>{
          if (['1','2','3','4','5'].includes(e.key)) {
            const idx = parseInt(e.key) - 1;
            const choice = el(`[data-choice-index="${idx}"]`);
            if (choice) choice.click();
          }
          if (e.key === 'ArrowRight') btnNext.click();
          if (e.key === 'ArrowLeft') btnPrev.click();
        });
      }

      function setProgress() {
        const total = mode === 'review' ? reviewList.length : questions.length;
        const pos = mode === 'review' ? reviewPos + 1 : current + 1;
        counter.textContent = `${mode === 'review' ? 'İnceleme' : 'Soru'} ${pos} / ${total}`;
        const pct = (pos/total)*100;
        barFill.style.width = pct + '%';
        modePill.textContent = mode === 'review' ? 'Review' : (mode === 'result' ? 'Sonuç' : 'Quiz');
      }

      function render() {
        if (mode === 'result') {
          const correct = correctness.filter(x => x === true).length;
          const wrong = correctness.filter(x => x === false).length;
          screen.innerHTML = `
            <div class="result">Bitti! ✅ Doğru: ${correct} • Yanlış: ${wrong}</div>
            <p class="muted">Yanlış işaretlediğiniz sorulara dönmek için aşağıdaki düğmeyi kullanın.</p>
          `;
          btnPrev.disabled = true;
          btnNext.textContent = "Başa Dön";
          btnNext.onclick = () => { current = 0; mode = 'quiz'; renderQuestion(); };
          reviewList = questions.map((_,i)=> i).filter(i => correctness[i] === false);
          btnReview.style.display = reviewList.length ? 'inline-block' : 'none';
          btnReview.onclick = () => {
            if (!reviewList.length) return;
            mode = 'review';
            reviewPos = 0;
            renderQuestion();
          };
          setProgress();
          return;
        }

        renderQuestion();
      }

      function getActiveIndex(){
        return mode === 'review' ? reviewList[reviewPos] : current;
      }

      function renderQuestion() {
        const idx = getActiveIndex();
        const q = questions[idx];
        const selected = selections[idx];
        const isAnswered = selected !== null;
        const isCorrect = correctness[idx];

        screen.innerHTML = `
          <div class="pill" style="margin-bottom:10px">${idx+1}. Soru</div>
          <div class="question-stem">${q.question}</div>
          <div class="choices">
            ${q.choices.map((c,i)=>{
              const classes = [];
              if (isAnswered) {
                if (i === selected) {
                  classes.push(i === q.answer ? 'correct' : 'incorrect');
                }
                if (i === q.answer) classes.push('correct');
                classes.push('disabled');
              }
              return \`<div class="choice \${classes.join(' ')}" role="button" data-choice-index="\${i}"><strong>\${String.fromCharCode(65+i)})</strong> \${c}</div>\`;
            }).join('')}
          </div>
        `;

        // wire up choices
        if (!isAnswered) {
          screen.querySelectorAll('.choice').forEach(ch => {
            ch.addEventListener('click', () => {
              const i = parseInt(ch.getAttribute('data-choice-index'));
              selections[idx] = i;
              const correct = (i === q.answer);
              correctness[idx] = !!correct;
              renderQuestion(); // re-render to colorize
              // auto-advance after a short delay if not last
              setTimeout(()=>{
                if (mode === 'quiz') {
                  if (current < questions.length - 1) {
                    current++;
                    renderQuestion();
                  } else {
                    mode = 'result';
                    render();
                  }
                } else if (mode === 'review') {
                  if (reviewPos < reviewList.length - 1) {
                    reviewPos++;
                    renderQuestion();
                  } else {
                    // end of review -> show result again
                    mode = 'result';
                    render();
                  }
                }
              }, 420);
            });
          });
        }

        // nav buttons
        if (mode === 'quiz') {
          btnPrev.disabled = current === 0;
          btnNext.textContent = current === questions.length - 1 ? "Bitir" : "Sonraki →";
          btnNext.onclick = () => {
            if (current < questions.length - 1) { current++; renderQuestion(); }
            else { mode = 'result'; render(); }
          };
        } else if (mode === 'review') {
          btnPrev.disabled = reviewPos === 0;
          btnNext.textContent = reviewPos === reviewList.length - 1 ? "Review Bitti" : "Sonraki →";
          btnNext.onclick = () => {
            if (reviewPos < reviewList.length - 1) { reviewPos++; renderQuestion(); }
            else { mode = 'result'; render(); }
          };
        }
        btnReview.style.display = mode === 'result' ? 'inline-block' : 'none';
        setProgress();
      }

      load();
    </script>
  </body>
</html>
